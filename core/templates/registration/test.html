<!--

To run this demo, you need to replace 'YOUR_API_KEY' with an API key from the ArcGIS Developer dashboard.

Sign up for a free account and get an API key.

https://developers.arcgis.com/documentation/mapping-apis-and-services/get-started/

-->

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ArcGIS JavaScript Tutorials: Find a route and directions (Auth)</title>
  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 500px;
      width: 500px;
    }

  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.23/"></script>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/Graphic",
      "esri/geometry/Point",
      "esri/rest/route",
      "esri/rest/support/RouteParameters",
      "esri/rest/support/FeatureSet",
      "esri/config"
    ],(Map, MapView, Graphic, Point, route, RouteParameters, FeatureSet, esriConfig)=> {

      const apiKey = "AAPK42283c0dc0834eafaecd07d3c3019657QplFUP_7bK8M-d2EuwT5SdUh166hJ6wBsj_TEnEzZtKa3_9AdjXuZDIqkhLmqZIv";

      esriConfig.apiKey = apiKey;

      
      const map = new Map({
        basemap: "arcgis-navigation"
      });

      const center = new Point ([-70.75218818957177, -33.510669277782604]);
      const origin = new Point([-70.75635285418065, -33.50867684226692]);
      const destination = new Point([-70.75218818957177, -33.510669277782604]);

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: center,
        zoom: 12,
        constraints: {
          snapToZoom: false
        }
      });

      view.when(()=> {
        addGraphic("start", origin);
        addGraphic("finish", destination);
        getRoute();
      });

      function addGraphic(type, point) {
        let color = "#ffffff";
        let outlineColor = "#000000"
        let size = "12px";
        if (type == "start") {
          color = "#ffffff";
        } else if (type == "stop") {
          color = "#000000";
          outlineColor = "#ffffff";
          size = "8px";
        } else {
          color = "#000000";
          outlineColor = "#ffffff";
        }
        const graphic = new Graphic({
          symbol: {
            type: "simple-marker",
            color: color,
            size: size,
            outline: {
              color: outlineColor,
              width: "1px"
            }
          },
          geometry: point
        });
        view.graphics.add(graphic);
      }

      function getRoute() {

        const routeUrl = "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";

        const routeParams = new RouteParameters({
          stops: new FeatureSet({
            features: view.graphics.toArray()
          }),
          returnDirections: true,
          directionsLanguage: "es"
        });

        route.solve(routeUrl, routeParams)
          .then((data)=> {
            if (data.routeResults.length > 0) {
              showRoute(data.routeResults[0].route);
              showDirections(data.routeResults[0].directions.features);
            }
          })
          .catch((error)=>{
            console.log(error);
          })
      }

      function showRoute(routeResult) {
        routeResult.symbol = {
          type: "simple-line",
          color: [5, 150, 255],
          width: 3
        };
        view.graphics.add(routeResult, 0);
      }
    });
  </script>
</head>
<body>
  <div id="viewDiv"></div>
</body>
</html>